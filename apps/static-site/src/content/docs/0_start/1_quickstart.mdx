---
title: "Quickstart"
---

import Notice from "@/components/Notice.astro";

This guide helps you quickly set up point-to-point sync between two PostgreSQL databases **without**
creating Manifests, see our [manifest guide](/docs/guides/managing-manifests) for more information.

# Preparing the Source Database

Before proceeding, you'll need to prepare your PostgreSQL database for ReJot. This includes:

- Enabling logical replication
- Creating a ReJot database role
- Setting up a PostgreSQL publication

See our [PostgreSQL Publications guide](/docs/guides/setup-postgres) for detailed instructions on
these steps.

# Defining a Public Schema

ReJot uses a ["Public Schema"](/docs/spec/public-schema) to define the data extracted from your
source database. Public schemas are SQL select statements executed whenever changes occur.

Here's an example for some `api_key` table:

```sql
-- my-public-schema.sql
SELECT
  id,
  key AS "api_key"
FROM
  api_key
WHERE
  id = $1;
```

# Verify the Public Schema

Before proceeding to the destination database setup, verify your public schema is set up correctly.
You can monitor outgoing synchronization messages using the `stdout` sink:

```bash
rejot-cli sync \
    --source "postgresql://postgres:password@localhost:5432/postgres" \
    --sink "stdout://" \
    --public-schema my-public-schema.sql
```

The synchronization process captures writes that have happened after the replication slot is
created. Lets insert some data to verify sync is working:

```sql
INSERT INTO
  api_key (key)
VALUES
  ('foo bar');
```

The output of the sync command should look something like:

```bash
rejot:sync-controller:info Processing transaction 17392 with 1 operations +66ms
{"operation":"insert","source":{"tableSchema":"public","tableName":"api_key"},"data":{"id":"2","api_key":"foo bar"}}
```

# Setting Up the Destination Database

After verifying the source, prepare your destination database. In this guide we'll create a target
table where sync will write the incoming changes.

```sql
CREATE TABLE target_table (id SERIAL PRIMARY KEY, api_key TEXT NOT NULL);
```

Next up we need to define a [consumer schema](/docs/spec/consumer-schema) to map data from the
public schema to your destination database.

For the example target table we can do the following:

```sql
-- my-consumer-schema.sql
INSERT INTO
  target_table (id, api_key)
VALUES
  ($1, $2::text)
ON CONFLICT (id) DO UPDATE
SET
  key = $2::text;
```

ReJot will substitute the `$1` and `$2` placeholders with the actual values from the public schema
we defined earlier.

# Start Synchronization

Start the synchronization process by providing the sink connection string and consumer schema to
`rejot-cli`:

```bash
rejot-cli sync \
    --source "postgresql://postgres:password@localhost:5432/postgres" \
    --sink "postgresql://postgres:password@destination:5432/target" \
    --public-schema my-public-schema.sql \
    --consumer-schema my-consumer-schema.sql
```

When new writes occur in the source database, you should see:

```bash
rejot:pg-sink:info Successfully wrote data to PostgreSQL sink
```

Verify the data in your destination table:

```sql
SELECT
  *
FROM
  target_table;
```

```
+----+----------------+
| id | api_key        |
|----+----------------|
| 1  | foo bar        |
+----+----------------+
```

You're now set up to synchronize PostgreSQL databases with ReJot!

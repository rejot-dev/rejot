---
import ArrowDownOnSquareStack from "astro-heroicons/outline/ArrowDownOnSquareStack.astro";
import Newspaper from "astro-heroicons/outline/Newspaper.astro";

import RejotIcon from "@/components/icons/ReJotIcon.astro";
import DatabaseNode from "@/components/index/hero/DatabaseNode.astro";
import { REJOT_DESCRIPTION } from "@/consts";

import GithubIcon from "../icons/GithubIcon.astro";
import LinkButton from "../LinkButton.astro";
import BackgroundGradient from "./BackgroundGradient.astro";
import InstallHint from "./hero/InstallHint.astro";
---

<div class="relative grid w-full grid-cols-10">
  <!-- Actual Hero text -->
  <div
    class="relative col-span-10 mx-8 mb-6 mt-auto space-y-6 md:order-2 md:col-span-6 md:-mb-20 xl:mx-12"
  >
    <div class="relative flex items-start justify-center gap-12">
      <BackgroundGradient />

      <div class="space-y-4 text-center">
        <h1 class="bg-clip-text text-4xl font-bold xl:text-5xl xl:leading-tight">
          <span
            class="bg-gradient-to-r from-rejot-red-600 to-rejot-orange-500 bg-clip-text text-transparent"
            >Supercharged</span
          > Replication for Developers
        </h1>

        <p class="text-xl text-gray-600 xl:text-2xl dark:text-gray-400">
          {REJOT_DESCRIPTION}
        </p>
      </div>
    </div>

    <div class="flex flex-wrap justify-center gap-4 font-medium">
      <LinkButton href="/docs/">Documentation</LinkButton>
      <LinkButton href="https://github.com/rejot-dev/rejot" secondary={true} target="_blank">
        <GithubIcon class="size-6" /> Star us
      </LinkButton>
    </div>

    <div class="mt-6 flex flex-col items-center space-y-3">
      <span class="text-sm font-semibold text-gray-600 dark:text-gray-400">Install</span>
      <InstallHint />
      <a
        href="/docs/start/quickstart"
        class="text-sm text-rejot-red-600 transition-colors hover:text-rejot-red-500 hover:underline dark:text-rejot-red-400 dark:hover:text-rejot-red-300"
      >
        Quickstart Guide â†’
      </a>
    </div>
  </div>

  <!-- DatabaseNode (left) -->
  <DatabaseNode
    class="relative col-span-4 mx-auto mt-auto md:order-1 md:col-span-2"
    header="Source Database"
    nodes={[
      { name: "Postgres", type: "database" },
      { name: "customers", type: "table" },
      { name: "orders", type: "table" },
      { name: "Change Data Capture", type: "active" },
    ]}
    color="blue"
    dots={["bottom"]}
  />

  <DatabaseNode
    class="relative col-span-4 col-start-7 mx-auto mt-auto md:order-3 md:col-span-2"
    header="Destination Database"
    nodes={[
      { name: "MySQL", type: "database" },
      { name: "users", type: "table" },
      { name: "orders", type: "table" },
      { name: "Change Data Capture", type: "active" },
    ]}
    color="blue"
    dots={["bottom"]}
  />

  <!-- Vertical Line (left) -->
  <div class="-z-10 col-span-4 size-full md:order-4 md:col-span-2">
    <div
      class="mx-auto h-full min-h-32 w-1 rounded-lg bg-gradient-to-b from-blue-300 to-purple-300 opacity-50"
    >
    </div>
  </div>

  <!-- ReJot Logo (circled) -->
  <div class="col-span-2 flex items-center justify-center md:order-8">
    <div
      class="group relative rounded-full bg-gradient-to-r from-rejot-orange-300 to-rejot-red-300 p-1 transition-all duration-500 hover:scale-110 hover:bg-gradient-to-r hover:from-rejot-red-300 hover:to-rejot-orange-300"
    >
      <div class="rounded-full bg-white/80 transition-all duration-500 group-hover:bg-white/70">
        <RejotIcon
          class="size-44 p-4 transition-transform duration-500 group-hover:rotate-12 md:p-6"
        />
      </div>

      <!-- Left dot -->
      <div
        class="absolute left-0 top-1/2 hidden size-2 -translate-y-1/2 translate-x-[-30%] rounded-full bg-rejot-orange-600 transition-all duration-500 group-hover:bg-rejot-red-600 md:block"
      >
      </div>

      <!-- Right dot -->
      <div
        class="absolute right-0 top-1/2 hidden size-2 -translate-y-1/2 translate-x-[30%] rounded-full bg-rejot-red-600 transition-all duration-500 group-hover:bg-rejot-orange-600 md:block"
      >
      </div>
    </div>
  </div>

  <!-- Vertical Line (right) -->
  <div class="-z-10 col-span-4 col-start-7 size-full md:order-5 md:col-span-2 md:col-start-9">
    <div
      class="mx-auto h-full min-h-32 w-1 rounded-lg bg-gradient-to-b from-blue-300 to-orange-300 opacity-50"
    >
    </div>
  </div>

  <DatabaseNode
    class="relative col-span-4 mx-auto md:order-6 md:col-span-2"
    header="Public Schema"
    nodes={[
      { name: "Credit Line", type: "name" },
      { name: "customer_id", type: "bigint" },
      { name: "amount", type: "bigint" },
      { name: "currency", type: "short" },
      { name: "Status", type: "active" },
    ]}
    color="purple"
    dots={["top", "right"]}
  >
    <Newspaper class="size-6" slot="icon" />
  </DatabaseNode>

  <!-- Horizontal Line (left, >md only) -->
  <div
    class="-z-10 col-span-1 hidden h-full items-center justify-center md:order-7 md:col-span-2 md:flex lg:-mx-16 xl:-mx-24"
  >
    <div
      class="h-1 w-full rounded-lg bg-gradient-to-r from-purple-300 to-rejot-orange-300 opacity-50"
    >
    </div>
  </div>

  <!-- Horizontal Line (right, >md only) -->
  <div
    class="-z-10 col-span-1 hidden h-full items-center justify-center md:order-9 md:col-span-2 md:col-start-7 md:flex lg:-mx-16 xl:-mx-24"
  >
    <div class="h-1 w-full rounded-lg bg-gradient-to-r from-rejot-red-300 to-orange-300 opacity-50">
    </div>
  </div>

  <!-- Horizontal Line (full, sm only) -->
  <div
    class="-z-10 col-span-2 -mx-24 flex h-full items-center justify-center md:order-9 md:col-span-2 md:col-start-7 md:hidden lg:-mx-16 xl:-mx-24"
  >
    <div class="h-1 w-full rounded-lg bg-gradient-to-r from-purple-300 to-orange-300 opacity-50">
    </div>
  </div>

  <DatabaseNode
    class="relative col-span-4 col-start-7 mx-auto md:order-10 md:col-span-2 md:col-start-9"
    header="Consumer Schema"
    nodes={[
      { name: "Credit Line", type: "name" },
      { name: "users", type: "table" },
      { name: "orders", type: "table" },
      { name: "Status", type: "active" },
    ]}
    color="orange"
    dots={["left", "top"]}
  >
    <ArrowDownOnSquareStack class="size-6" slot="icon" />
  </DatabaseNode>
</div>

<script>
  function setupInstallCommand() {
    // Copy to clipboard functionality
    const installCommand = document.getElementById("install-command");
    const hoverTextEl = document.getElementById("install-hover-text");

    const commandText = "npm install -g @rejot-dev/cli";

    if (!installCommand || !hoverTextEl) {
      return;
    }

    const originalText = hoverTextEl.textContent;
    let timeout: number | null = null;

    installCommand?.addEventListener("click", async () => {
      await navigator.clipboard.writeText(commandText);

      hoverTextEl.textContent = "Copied!";

      if (timeout) {
        clearTimeout(timeout);
      }

      timeout = setTimeout(() => {
        hoverTextEl.textContent = originalText;
      }, 1000) as unknown as number;
    });
  }

  setupInstallCommand();
</script>
